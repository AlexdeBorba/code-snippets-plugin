{"generator":"Code Snippets v2.14.0","date_created":"2020-03-30 20:19","snippets":[{"name":"WordPress: Restore CSV upload functionality for WordPress 4.9.9 and 5.0.1","tags":["wordpress","csv","upload"],"scope":"admin","code":"add_filter('wp_check_filetype_and_ext', function($values, $file, $filename, $mimes) {\n\tif ( extension_loaded( 'fileinfo' ) ) {\n\t\t\/\/ with the php-extension, a CSV file is issues type text\/plain so we fix that back to \n\t\t\/\/ text\/csv by trusting the file extension.\n\t\t$finfo     = finfo_open( FILEINFO_MIME_TYPE );\n\t\t$real_mime = finfo_file( $finfo, $file );\n\t\tfinfo_close( $finfo );\n\t\tif ( $real_mime === 'text\/plain' && preg_match( '\/\\.(csv)$\/i', $filename ) ) {\n\t\t\t$values['ext']  = 'csv';\n\t\t\t$values['type'] = 'text\/csv';\n\t\t}\n\t} else {\n\t\t\/\/ without the php-extension, we probably don't have the issue at all, but just to be sure...\n\t\tif ( preg_match( '\/\\.(csv)$\/i', $filename ) ) {\n\t\t\t$values['ext']  = 'csv';\n\t\t\t$values['type'] = 'text\/csv';\n\t\t}\n\t}\n\treturn $values;\n}, PHP_INT_MAX, 4);","priority":"10"}]}