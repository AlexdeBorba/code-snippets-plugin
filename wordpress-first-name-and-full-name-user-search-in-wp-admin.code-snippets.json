{"generator":"Code Snippets v2.14.0","date_created":"2020-03-24 20:28","snippets":[{"name":"WordPress: First name and full name user search in wp-admin","tags":["wordpress","user","search"],"scope":"admin","code":"\/* version check *\/\nglobal $wp_version;\n\nif(version_compare($wp_version,\"4.1\",\"<\")) {\n\texit(__('User First Name \/ Full Name Search In WP-admin requires WordPress version 4.1 or higher. \n\t\t\t\t<a href=\"http:\/\/codex.wordpress.org\/Upgrading_Wordpress\">Please update!<\/a>', 'fullname-user-search-in-WP-admin'));\n}\n\n\/\/ Plugin is build to be used only in wpadmin\nif(is_admin()) {\n\t\n\n\t\/\/ Action to inject custom search queries\n    add_action('pre_user_query', 'empowering_user_search');\t\n\n   \/\/ Main function responsible for enhancing the search\n    function empowering_user_search($wp_user_query) {\n        if(false === strpos($wp_user_query->query_where, '@') && !empty($_GET[\"s\"])) {\n\n            global $wpdb;\n\n            $uids=array();\t\t\t\n\n\t\t\t$flsiwa_add = \"\";\n\t\t\t\/\/ Escaped query string\n\t\t\t$qstr = esc_sql($_GET[\"s\"]);\n\n\t\t\tif(preg_match('\/\\s\/',$qstr)){\n\t\t\t\t$pieces = explode(\" \", $qstr);\n\t\t\t\t$user_ids_collector = $wpdb->get_results(\"SELECT DISTINCT user_id FROM $wpdb->usermeta WHERE (meta_key='first_name' AND LOWER(meta_value) LIKE '%\".$pieces[0].\"%')\");\n\n\t            foreach($user_ids_collector as $maf) {\n\t                if(strtolower(get_user_meta($maf->user_id, 'last_name', true)) == strtolower($pieces[1])){\n\t\t\t\t\t\tarray_push($uids,$maf->user_id);\n\t                }\n\t            }\n\n\t\t\t}else{\t\t\t\t\n\n\t\t\t\t$user_ids_collector = $wpdb->get_results(\"SELECT DISTINCT user_id FROM $wpdb->usermeta WHERE (meta_key='first_name' OR meta_key='last_name'\".$flsiwa_add.\") AND LOWER(meta_value) LIKE '%\".$qstr.\"%'\");\n\t\t\t\t\tforeach($user_ids_collector as $maf) {\n\t                array_push($uids,$maf->user_id);\n\t            }\n\t\t\t}\n\n            $users_ids_collector = $wpdb->get_results(\"SELECT DISTINCT ID FROM $wpdb->users WHERE LOWER(user_nicename) LIKE '%\".$qstr.\"%' OR LOWER(user_email) LIKE '%\".$qstr.\"%'\");\n\n            foreach($users_ids_collector as $maf) {\n                if(!in_array($maf->ID,$uids)) {\n                    array_push($uids,$maf->ID);\n                }\n            }\n\n            $id_string = implode(\",\",$uids);\n\t\t\tif (!empty($id_string))\n\t\t\t{\n\t            $wp_user_query->query_where = str_replace(\"user_nicename LIKE '%\".$qstr.\"%'\", \"ID IN(\".$id_string.\")\", $wp_user_query->query_where);\n\t\t\t}\n        }\n        return $wp_user_query;\n    }\n}\n\nregister_activation_hook(__FILE__,\"fullname_user_search_in_wpadmin_activate\");\n\nfunction fullname_user_search_in_wpadmin_activate() {\n\tregister_uninstall_hook(__FILE__,\"fullname_user_search_in_wpadmin_uninstall\");\n}\n\nfunction fullname_user_search_in_wpadmin_uninstall() {\n\tdelete_option('flsiwa_meta_fields');\n}","priority":"10"}]}