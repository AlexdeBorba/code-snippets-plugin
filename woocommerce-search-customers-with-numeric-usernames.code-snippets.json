{"generator":"Code Snippets v2.14.0","date_created":"2020-03-31 16:08","snippets":[{"name":"WooCommerce: Search customers with numeric usernames","tags":["woocommerce","customers","search"],"scope":"admin","code":"add_action( 'wp_ajax_woocommerce_json_search_customers', 'wc_search_customers', 5 );\n\nfunction wc_search_customers() {\nob_start();\n\n\tcheck_ajax_referer( 'search-customers', 'security' );\n\n\tif ( ! current_user_can( 'edit_shop_orders' ) ) {\n\t\tdie(-1);\n\t}\n\n\t$term    = wc_clean( stripslashes( $_GET['term'] ) );\n\t$exclude = array();\n\n\tif ( empty( $term ) ) {\n\t\tdie();\n\t}\n\n\tif ( ! empty( $_GET['exclude'] ) ) {\n\t\t$exclude = array_map( 'intval', explode( ',', $_GET['exclude'] ) );\n\t}\n\n\t$found_customers = array();\n\n\n\t$customers_query = new WP_User_Query( apply_filters( 'woocommerce_json_search_customers_query', array(\n\t\t'fields'         => 'all',\n\t\t'orderby'        => 'display_name',\n\t\t'search'         => '*' . $term . '*',\n\t\t'search_columns' => array( 'ID', 'user_login', 'user_email', 'user_nicename' )\n\t) ) );\n\nerror_log( print_r( $customers_query, true ) );\n\t$customers = $customers_query->get_results();\n\n\tif ( ! empty( $customers ) ) {\n\t\tforeach ( $customers as $customer ) {\n\t\t\tif ( ! in_array( $customer->ID, $exclude ) ) {\n\t\t\t\t$found_customers[ $customer->ID ] = $customer->display_name . ' (#' . $customer->ID . ' &ndash; ' . sanitize_email( $customer->user_email ) . ')';\n\t\t\t}\n\t\t}\n\t}\n\n\t$found_customers = apply_filters( 'woocommerce_json_search_found_customers', $found_customers );\n\n\twp_send_json( $found_customers );\n}","priority":"10"}]}