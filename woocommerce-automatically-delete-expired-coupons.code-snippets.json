{"generator":"Code Snippets v2.14.0","date_created":"2020-03-23 00:25","snippets":[{"name":"WooCommerce: Automatically delete expired coupons","tags":["woocommerce","coupons"],"scope":"admin","code":"add_action( 'init', 'schedule_delete_expired_coupons' );\n\n\/**\n * Trash all expired coupons when the event is triggered.\n *\/\nfunction delete_expired_coupons() {\n\t$args = array(\n\t\t'posts_per_page' => -1,\n\t\t'post_type'      => 'shop_coupon',\n\t\t'post_status'    => 'publish',\n\t\t'meta_query'     => array(\n\t\t\t'relation'   => 'AND',\n\t\t\tarray(\n\t\t\t\t'key'     => 'expiry_date',\n\t\t\t\t'value'   => current_time( 'Y-m-d' ),\n\t\t\t\t'compare' => '<='\n\t\t\t),\n\t\t\tarray(\n\t\t\t\t'key'     => 'expiry_date',\n\t\t\t\t'value'   => '',\n\t\t\t\t'compare' => '!='\n\t\t\t)\n\t\t)\n\t);\n\n\t$coupons = get_posts( $args );\n\n\tif ( ! empty( $coupons ) ) {\n\t\t$current_time = current_time( 'timestamp' );\n\n\t\tforeach ( $coupons as $coupon ) {\n\t\t\twp_trash_post( $coupon->ID );\n\t\t}\n\t}\n}\nadd_action( 'delete_expired_coupons', 'delete_expired_coupons' );","priority":"10"}]}